Version 4
SHEET 1 5528 1476
WIRE 2752 -928 2624 -928
WIRE 2896 -928 2752 -928
WIRE 3280 -928 2896 -928
WIRE 4064 -928 3280 -928
WIRE 4064 -896 4064 -928
WIRE 2624 -848 2624 -928
WIRE 2896 -848 2896 -928
WIRE 4064 -784 4064 -816
WIRE 4064 -784 3968 -784
WIRE 4160 -784 4064 -784
WIRE 3968 -752 3968 -784
WIRE 4160 -752 4160 -784
WIRE 1968 -736 1968 -816
WIRE 2896 -704 2896 -768
WIRE 3904 -704 2896 -704
WIRE 4288 -704 4224 -704
WIRE 544 -688 544 -720
WIRE 816 -688 544 -688
WIRE 544 -656 544 -688
WIRE 816 -656 816 -688
WIRE 1968 -608 1968 -656
WIRE 2624 -592 2624 -768
WIRE 4288 -592 4288 -704
WIRE 4288 -592 2624 -592
WIRE 1728 -544 1344 -544
WIRE 1920 -544 1808 -544
WIRE 544 -528 544 -576
WIRE 816 -528 816 -576
WIRE 1968 -496 1968 -512
WIRE 1968 -496 1840 -496
WIRE 640 -480 608 -480
WIRE 752 -480 640 -480
WIRE 3280 -480 3280 -928
WIRE 1968 -448 1968 -496
WIRE 2624 -448 2624 -592
WIRE 2720 -448 2624 -448
WIRE 2896 -448 2896 -704
WIRE 2896 -448 2784 -448
WIRE 4160 -448 4160 -656
WIRE 4304 -448 4160 -448
WIRE 4448 -448 4304 -448
WIRE 4528 -448 4448 -448
WIRE -560 -400 -576 -400
WIRE 208 -400 208 -448
WIRE 544 -400 544 -432
WIRE 640 -400 640 -480
WIRE 640 -400 544 -400
WIRE 816 -400 816 -432
WIRE 912 -400 816 -400
WIRE 1104 -400 912 -400
WIRE 4160 -400 4160 -448
WIRE 4304 -400 4304 -448
WIRE 4448 -400 4448 -448
WIRE 1840 -368 1840 -496
WIRE 1968 -368 1968 -384
WIRE 1968 -368 1840 -368
WIRE -576 -352 -576 -400
WIRE -48 -352 -48 -432
WIRE -48 -352 -112 -352
WIRE -16 -352 -48 -352
WIRE 96 -352 96 -432
WIRE 96 -352 64 -352
WIRE 144 -352 96 -352
WIRE 3280 -352 3280 -400
WIRE 1968 -336 1968 -368
WIRE 2624 -336 2624 -448
WIRE 2720 -336 2624 -336
WIRE 2896 -336 2896 -448
WIRE 2896 -336 2784 -336
WIRE 1104 -320 1104 -400
WIRE 1104 -320 1024 -320
WIRE 1168 -320 1104 -320
WIRE 4304 -304 4304 -336
WIRE 4448 -304 4448 -336
WIRE 1024 -272 1024 -320
WIRE 1168 -272 1168 -320
WIRE 4160 -272 4160 -320
WIRE -576 -240 -576 -272
WIRE 208 -240 208 -304
WIRE 688 -240 208 -240
WIRE 3280 -240 3280 -272
WIRE 3280 -240 3184 -240
WIRE 3376 -240 3280 -240
WIRE 1968 -224 1968 -272
WIRE 3184 -208 3184 -240
WIRE 3376 -208 3376 -240
WIRE 208 -192 208 -240
WIRE 688 -160 688 -240
WIRE 880 -160 688 -160
WIRE 1024 -160 1024 -208
WIRE 1024 -160 880 -160
WIRE 1168 -160 1168 -208
WIRE 1312 -160 1168 -160
WIRE 1344 -160 1344 -544
WIRE 1344 -160 1312 -160
WIRE 2624 -144 2624 -336
WIRE 2896 -144 2896 -336
WIRE 1024 -96 1024 -160
WIRE 1168 -96 1168 -160
WIRE 1840 -96 1840 -368
WIRE 1968 -96 1968 -160
WIRE 1968 -96 1840 -96
WIRE 2144 -96 1968 -96
WIRE 2192 -96 2144 -96
WIRE 2560 -96 2192 -96
WIRE 3040 -96 2960 -96
WIRE 3088 -96 3040 -96
WIRE 3184 -96 3184 -144
WIRE 3184 -96 3088 -96
WIRE 3376 -96 3376 -144
WIRE 3568 -96 3376 -96
WIRE 3632 -96 3568 -96
WIRE 3776 -96 3632 -96
WIRE 3968 -96 3968 -656
WIRE 3968 -96 3776 -96
WIRE 208 -64 208 -112
WIRE 1312 -64 1312 -160
WIRE 3968 -64 3968 -96
WIRE 2144 -48 2144 -96
WIRE 3040 -48 3040 -96
WIRE 3184 -48 3184 -96
WIRE 3376 -48 3376 -96
WIRE 3632 -48 3632 -96
WIRE 3776 -48 3776 -96
WIRE 2624 0 2624 -48
WIRE 2768 0 2624 0
WIRE 2896 0 2896 -48
WIRE 2896 0 2768 0
WIRE 1024 32 1024 -32
WIRE 1104 32 1024 32
WIRE 1168 32 1168 -32
WIRE 1168 32 1104 32
WIRE 1312 32 1312 0
WIRE 1968 32 1968 -96
WIRE 3184 48 3184 16
WIRE 3280 48 3184 48
WIRE 3376 48 3376 16
WIRE 3376 48 3280 48
WIRE 3632 48 3632 16
WIRE 3776 48 3776 16
WIRE 3968 48 3968 16
WIRE 2144 64 2144 32
WIRE 3040 64 3040 32
WIRE 3280 80 3280 48
WIRE 704 96 432 96
WIRE 1920 96 1856 96
WIRE 2768 112 2768 0
WIRE 912 128 816 128
WIRE 1104 128 1104 32
WIRE 1104 128 912 128
WIRE 1968 144 1968 128
WIRE 3632 144 3632 112
WIRE 3776 144 3776 112
WIRE 544 160 544 -400
WIRE 816 160 816 128
WIRE 2704 160 2528 160
WIRE -176 176 -176 144
WIRE 320 176 320 144
WIRE 288 192 256 192
WIRE 3280 192 3280 160
WIRE 432 208 432 96
WIRE 432 208 352 208
WIRE 480 208 432 208
WIRE 704 208 704 96
WIRE 752 208 704 208
WIRE 2528 208 2528 160
WIRE 288 224 128 224
WIRE 3632 240 3632 208
WIRE 3712 240 3632 240
WIRE 3776 240 3776 208
WIRE 3776 240 3712 240
WIRE 1856 256 1856 96
WIRE 1968 256 1968 224
WIRE 1968 256 1856 256
WIRE 128 272 128 224
WIRE 2768 272 2768 208
WIRE 3712 272 3712 240
WIRE -176 288 -176 256
WIRE -64 288 -176 288
WIRE 256 288 256 192
WIRE 544 288 544 256
WIRE 544 288 256 288
WIRE 1968 304 1968 256
WIRE 3280 304 3280 272
WIRE -176 320 -176 288
WIRE -64 320 -64 288
WIRE 320 320 320 240
WIRE 544 320 544 288
WIRE 816 320 816 256
WIRE 2528 336 2528 288
WIRE 128 384 128 352
WIRE 2768 400 2768 352
WIRE 3392 416 3392 368
WIRE 3392 416 3216 416
WIRE 3584 416 3392 416
WIRE 544 432 544 400
WIRE 816 432 816 400
WIRE 816 432 544 432
WIRE -176 448 -176 400
WIRE 544 464 544 432
WIRE 3216 464 3216 416
WIRE 3584 464 3584 416
WIRE 4000 512 3904 512
WIRE 4176 512 4080 512
WIRE 3216 656 3216 544
WIRE 3744 656 3216 656
WIRE 3904 656 3904 512
WIRE 3904 656 3824 656
WIRE 1632 672 1312 672
WIRE 1856 672 1696 672
WIRE 4016 688 4016 656
WIRE 3904 704 3904 656
WIRE 3984 704 3904 704
WIRE 4176 720 4176 512
WIRE 4176 720 4048 720
WIRE 3584 736 3584 544
WIRE 3744 736 3584 736
WIRE 3904 736 3824 736
WIRE 3984 736 3904 736
WIRE 3216 768 3216 656
WIRE 3584 768 3584 736
WIRE 3904 768 3904 736
WIRE 1696 784 1648 784
WIRE 1856 784 1856 672
WIRE 1856 784 1776 784
WIRE 4016 800 4016 752
WIRE 1440 816 1328 816
WIRE 2928 816 2816 816
WIRE 3072 816 3008 816
WIRE 3152 816 3072 816
WIRE 3712 816 3648 816
WIRE 3712 864 3712 816
WIRE 3072 880 3072 816
WIRE 3904 880 3904 848
WIRE 1392 928 1392 896
WIRE 1328 944 1328 816
WIRE 1360 944 1328 944
WIRE 1728 944 1728 912
WIRE 1440 960 1440 816
WIRE 1440 960 1424 960
WIRE 1536 960 1440 960
WIRE 1648 960 1648 784
WIRE 1648 960 1616 960
WIRE 1696 960 1648 960
WIRE 3216 960 3216 864
WIRE 3264 960 3216 960
WIRE 3408 960 3344 960
WIRE 3456 960 3408 960
WIRE 3584 960 3584 864
WIRE 3584 960 3536 960
WIRE 1312 976 1312 672
WIRE 1360 976 1312 976
WIRE 1856 976 1856 784
WIRE 1856 976 1760 976
WIRE 1696 992 1664 992
WIRE 3072 992 3072 960
WIRE 1392 1024 1392 992
WIRE 1664 1040 1664 992
WIRE 1728 1056 1728 1008
WIRE 3408 1088 3408 960
WIRE 3184 1104 3184 1072
WIRE 3152 1120 3104 1120
WIRE 3344 1136 3216 1136
WIRE 3152 1152 2960 1152
WIRE 2960 1200 2960 1152
WIRE 3184 1200 3184 1168
WIRE 3104 1232 3104 1120
WIRE 3408 1232 3408 1184
WIRE 3408 1232 3104 1232
WIRE 3408 1264 3408 1232
WIRE 2960 1328 2960 1280
WIRE 3408 1376 3408 1344
FLAG 544 464 -12v
FLAG 912 -400 i_source
FLAG 912 128 i_sink
FLAG 544 -720 +12v
FLAG 320 320 -12v
FLAG 320 144 +12v
FLAG -64 320 0
FLAG -176 144 +12v
FLAG -176 448 -12v
FLAG 1312 32 0
FLAG 2192 -96 triangle_out
FLAG -704 -400 square_out
FLAG -576 -240 0
FLAG -560 -400 square_in
FLAG 1968 -816 +12v
FLAG 1344 -160 tcap
FLAG 1968 304 -12v
FLAG 2144 64 0
FLAG 128 384 0
FLAG 1728 912 +12v
FLAG 1728 1056 -12v
FLAG 1664 1040 0
FLAG 1120 976 tcap
FLAG 2768 400 -12v
FLAG 2752 -928 +12v
FLAG 2528 336 0
FLAG 4160 -272 -12v
FLAG 4528 -448 square_out
FLAG 3712 272 0
FLAG 3968 48 -12v
FLAG 3280 304 -12v
FLAG 3040 64 0
FLAG 4304 -304 0
FLAG 1392 896 +12v
FLAG 1392 1024 -12v
FLAG 880 -160 square_in_buf
FLAG 3568 -96 square_fb
FLAG -112 -352 square_fb
FLAG 208 -64 -12v
FLAG 208 -448 +12v
FLAG 3088 -96 triangle_comp
FLAG 2816 816 triangle_out
FLAG 3072 992 0
FLAG 3392 368 +12v
FLAG 3184 1072 +12v
FLAG 3184 1200 -12v
FLAG 2960 1328 0
FLAG 3712 864 0
FLAG 4448 -304 0
FLAG 3408 1376 -12v
FLAG 4016 656 +12v
FLAG 4016 800 -12v
FLAG 3904 880 0
SYMBOL OP07 320 144 R0
SYMATTR InstName U1
SYMBOL npn 480 160 R0
SYMATTR InstName Q1
SYMATTR Value 2N3904
SYMBOL npn 752 160 R0
SYMATTR InstName Q2
SYMATTR Value 2N3904
SYMBOL res 528 304 R0
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL res 800 304 R0
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL pnp 608 -432 R180
SYMATTR InstName Q3
SYMATTR Value 2N3906
SYMBOL pnp 752 -432 M180
SYMATTR InstName Q4
SYMATTR Value 2N3906
SYMBOL res 528 -672 R0
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL res 800 -672 R0
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL voltage -176 160 R0
SYMATTR InstName V1
SYMATTR Value 12
SYMBOL voltage -176 304 R0
SYMATTR InstName V2
SYMATTR Value 12
SYMBOL diode 1008 -272 R0
SYMATTR InstName D1
SYMATTR Value 1N5711
SYMBOL diode 1152 -272 R0
SYMATTR InstName D2
SYMATTR Value 1N5711
SYMBOL diode 1008 -96 R0
SYMATTR InstName D3
SYMATTR Value 1N5711
SYMBOL diode 1152 -96 R0
SYMATTR InstName D4
SYMATTR Value 1N5711
SYMBOL cap 1296 -64 R0
SYMATTR InstName C1
SYMATTR Value 1.36n
SYMATTR SpiceLine IC=0
SYMBOL voltage -576 -368 R0
WINDOW 3 -158 171 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(-1 1 0 1n 1n {(1/f)*0.75} {1/f} 2)
SYMATTR InstName V3
SYMBOL njf 1920 -608 R0
SYMATTR InstName J1
SYMATTR Value J310
SYMBOL res 1952 128 R0
SYMATTR InstName R10
SYMATTR Value 300
SYMBOL res 1952 -752 R0
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL res 2128 -64 R0
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL njf 1920 32 R0
SYMATTR InstName J2
SYMATTR Value J310
SYMBOL voltage 128 256 R0
SYMATTR InstName V4
SYMATTR Value -6
SYMBOL OP07 1728 912 R0
SYMATTR InstName U2
SYMBOL res 1792 768 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 9k
SYMBOL res 1632 944 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL cap 1696 656 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 1µ
SYMATTR SpiceLine IC=0
SYMBOL npn 2560 -144 R0
SYMATTR InstName Q6
SYMATTR Value 2N3904
SYMBOL npn 2960 -144 M0
SYMATTR InstName Q7
SYMATTR Value 2N3904
SYMBOL npn 2704 112 R0
SYMATTR InstName Q8
SYMATTR Value 2N3904
SYMBOL res 2752 256 R0
SYMATTR InstName R12
SYMATTR Value 2k
SYMBOL diode 2720 -320 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D5
SYMATTR Value 1N4148
SYMBOL diode 2784 -464 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D6
SYMATTR Value 1N4148
SYMBOL res 2608 -864 R0
SYMATTR InstName R15
SYMATTR Value 4k
SYMBOL res 2880 -864 R0
SYMATTR InstName R16
SYMATTR Value 4k
SYMBOL voltage 2528 192 R0
SYMATTR InstName V7
SYMATTR Value -3.4
SYMBOL pnp 3904 -656 M180
WINDOW 0 -50 88 Left 2
WINDOW 3 -70 116 Left 2
SYMATTR InstName Q9
SYMATTR Value 2N3906
SYMBOL pnp 4224 -656 R180
WINDOW 0 -47 78 Left 2
WINDOW 3 -86 108 Left 2
SYMATTR InstName Q10
SYMATTR Value 2N3906
SYMBOL res 4048 -912 R0
SYMATTR InstName R17
SYMATTR Value 910
SYMBOL res 4144 -416 R0
SYMATTR InstName R18
SYMATTR Value 2.7k
SYMBOL diode 3616 -48 R0
SYMATTR InstName D7
SYMATTR Value 1N4148
SYMBOL diode 3616 48 R0
SYMATTR InstName D8
SYMATTR Value 1N4148
SYMBOL diode 3616 144 R0
SYMATTR InstName D9
SYMATTR Value 1N4148
SYMBOL diode 3760 208 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D10
SYMATTR Value 1N4148
SYMBOL diode 3760 112 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D11
SYMATTR Value 1N4148
SYMBOL diode 3760 16 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D12
SYMATTR Value 1N4148
SYMBOL res 3952 -80 R0
SYMATTR InstName R19
SYMATTR Value 2.7k
SYMBOL diode 3168 -208 R0
SYMATTR InstName D13
SYMATTR Value 1N4148
SYMBOL diode 3360 -208 R0
SYMATTR InstName D14
SYMATTR Value 1N4148
SYMBOL diode 3168 -48 R0
SYMATTR InstName D15
SYMATTR Value 1N4148
SYMBOL diode 3360 -48 R0
SYMATTR InstName D16
SYMATTR Value 1N4148
SYMBOL res 3264 -368 R0
SYMATTR InstName R20
SYMATTR Value 13k
SYMBOL res 3264 -496 R0
SYMATTR InstName R21
SYMATTR Value 1.1k
SYMBOL res 3264 64 R0
SYMATTR InstName R22
SYMATTR Value 13k
SYMBOL res 3264 176 R0
SYMATTR InstName R23
SYMATTR Value 1.1k
SYMBOL res 3024 -64 R0
SYMATTR InstName R24
SYMATTR Value 499
SYMBOL diode 4288 -336 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D18
SYMATTR Value 1N5711
SYMBOL diode 4432 -400 R0
SYMATTR InstName D19
SYMATTR Value 1N5711
SYMBOL OP07 1392 896 R0
SYMATTR InstName U3
SYMBOL diode 1952 -224 R0
SYMATTR InstName D21
SYMATTR Value 1N914
SYMBOL diode 1952 -336 R0
SYMATTR InstName D22
SYMATTR Value 1N914
SYMBOL diode 1952 -448 R0
SYMATTR InstName D23
SYMATTR Value 1N914
SYMBOL npn 144 -400 R0
SYMATTR InstName Q12
SYMATTR Value 2N3904
SYMBOL res 192 -208 R0
SYMATTR InstName R13
SYMATTR Value 1k
SYMBOL res 80 -368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 300
SYMBOL res 1824 -560 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 100
SYMBOL res 3024 800 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 1.3k
SYMBOL res 3088 976 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R25
SYMATTR Value 1k
SYMBOL npn 3152 768 R0
SYMATTR InstName Q5
SYMATTR Value 2N3904
SYMBOL res 3360 944 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R26
SYMATTR Value 10
SYMBOL res 3552 944 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R27
SYMATTR Value 10
SYMBOL npn 3648 768 M0
SYMATTR InstName Q11
SYMATTR Value 2N3904
SYMBOL res 3200 448 R0
SYMATTR InstName R28
SYMATTR Value 1k
SYMBOL res 3568 448 R0
SYMATTR InstName R29
SYMATTR Value 1k
SYMBOL npn 3344 1088 R0
SYMATTR InstName Q13
SYMATTR Value 2N3904
SYMBOL res 3392 1248 R0
SYMATTR InstName R30
SYMATTR Value 500
SYMBOL Opamps\\OP07 3184 1072 R0
SYMATTR InstName U4
SYMBOL voltage 2960 1184 R0
SYMATTR InstName V5
SYMATTR Value -9
SYMBOL res 3840 720 R90
WINDOW 0 54 116 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R31
SYMATTR Value 1.2Meg
SYMBOL res 3920 864 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R32
SYMATTR Value 100k
SYMBOL res 3840 640 R90
WINDOW 0 7 112 VBottom 2
WINDOW 3 -16 4 VTop 2
SYMATTR InstName R33
SYMATTR Value 1.2Meg
SYMBOL res 4096 496 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R34
SYMATTR Value 100k
SYMBOL Opamps\\opamp2 4016 656 R0
SYMATTR InstName U6
SYMATTR Value LF356/NS
TEXT 96 568 Left 2 !.tran 0 {5/f} {0/f} {1/f/100}
TEXT 1016 -952 Left 2 !.param f=2Meg
TEXT 1016 -904 Left 2 !.MODEL 1N5711 D (IS=19.7n N=1.51 BV=93.3 IBV=50n RS=6.27 CJO=1.8p VJ=.75 M=.333 XTI=2 EG=.69 TT=10.8p type=Schottky)
TEXT 1016 -880 Left 2 !.include LF356.MOD
